This is in python, translate to C if efficiency is going to matter a lot
