Sorry about the spaghetti code, will comment the code some time later.

We choose the hyperparameters through trial and error
